import{c as o,b as T,u as q,r as l,j as e,a as h,g as _}from"./index-DxkU6T3I.js";import{b as R,c as a,a as B,X as U}from"./CustomDatePicker-T4IMFbDZ.js";import{U as V}from"./user-CwbVznwV.js";import{C as W}from"./calendar-CMNTU1_T.js";import{C as m}from"./clock-ZWQxUhjj.js";import{B as G,G as X}from"./globe-BAOjvFjv.js";const Y=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],S=o("arrow-right-left",Y);const J=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],z=o("scissors",J);const K=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],M=o("square-pen",K);const Q=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],$=o("trash-2",Q);const Z=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],P=o("truck",Z);function de(){const{id:n}=T(),g=q(),[s,E]=l.useState(null),[F,y]=l.useState(!0),[j,H]=l.useState(null),[v,p]=l.useState(null),[I,i]=l.useState(!1),[c,N]=l.useState(""),[u,b]=l.useState("cash"),[w,k]=l.useState(""),D=()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},f=async()=>{try{const t=await h.get(`/orders/${n}`);E(t.data),y(!1)}catch{H("Failed to load order"),y(!1)}};l.useEffect(()=>{f()},[n]);const x=async t=>{try{const r=t==="delivered"?w||new Date().toISOString().split("T")[0]:null;await h.put(`/orders/${n}/status`,{status:t,payment_amount:t==="delivered"?c:0,payment_method:u,actual_delivery_date:r}),i(!1),N(""),b("cash"),k(""),f()}catch{alert("Failed to update status")}},L=async t=>{if(confirm("Delete this image?"))try{await h.delete(`/orders/${n}/images/${t}`),f()}catch{alert("Failed to delete image")}};return F?e.jsx("div",{className:"flex justify-center items-center h-screen text-[#075E54] font-bold",children:"Loading..."}):j?e.jsx("div",{className:"text-center text-red-500 mt-10 font-bold",children:j}):e.jsxs("div",{className:"min-h-screen bg-[#ECE5DD] pb-10 font-sans",children:[e.jsx("header",{className:"glass-header-green text-white p-4 sticky top-0 z-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>g(-1),className:"p-2 -ml-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",children:e.jsx(R,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Order Details"}),e.jsx("p",{className:"text-xs opacity-80",children:"View order information"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(`/orders/${n}/edit`),className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",children:e.jsx(M,{size:18})}),e.jsx("button",{onClick:()=>{confirm("Delete order?")&&h.delete(`/orders/${n}`).then(()=>g("/dashboard"))},className:"p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors",children:e.jsx($,{size:18})})]})]})}),e.jsxs("main",{className:"px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Order #",s?.token]}),e.jsx("p",{className:"text-sm text-gray-500 font-medium mt-1",children:s?.created_at?new Date(s.created_at).toLocaleDateString():"No Date"})]}),e.jsx("span",{className:a("px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide border",s?.status==="pending"&&"bg-amber-50 text-amber-600 border-amber-100",s?.status==="ready"&&"bg-blue-50 text-blue-600 border-blue-100",s?.status==="delivered"&&"bg-green-50 text-green-600 border-green-100",s?.status==="transferred"&&"bg-purple-50 text-purple-600 border-purple-100"),children:s?.status})]}),e.jsxs("div",{className:"glass-card rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-teal-50 flex items-center justify-center text-[#128C7E]",children:e.jsx(V,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Customer"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s?.customer_name||"Walk-in Customer"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-rose-50 flex items-center justify-center text-rose-600",children:e.jsx(W,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Delivery Date"}),e.jsx("p",{className:"font-semibold text-gray-900",children:s?.delivery_date?new Date(s.delivery_date).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Not Set"})]})]})]}),e.jsx("div",{className:"glass-card rounded-xl p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Remaining Balance"}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-xl font-bold text-red-500 block",children:["₹",s?.balance||0]})})]})}),s?.payments?.length>0&&e.jsxs("div",{className:"glass-card rounded-xl overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-100",children:e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Payment History"})}),e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-50/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 font-medium",children:"Date"}),e.jsx("th",{className:"px-4 py-2 font-medium",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 font-medium",children:"Method"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.payments.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-2 text-gray-600",children:new Date(t.payment_date).toLocaleDateString(void 0,{day:"numeric",month:"short"})}),e.jsxs("td",{className:"px-4 py-2 font-bold text-green-600",children:["₹",t.amount]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`text-xs font-bold uppercase px-2 py-0.5 rounded-full ${t.payment_method==="online"||t.payment_method==="upi"?"bg-blue-100 text-blue-600":"bg-green-100 text-green-600"}`,children:t.payment_method==="upi"?"online":t.payment_method||"cash"})})]},t.id))})]})]}),s?.images?.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider mb-3",children:"Measurements / Photos"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:s.images.map(t=>e.jsxs("div",{className:"relative aspect-square rounded-2xl overflow-hidden bg-gray-100 border border-gray-200 shadow-sm group",children:[e.jsx("img",{src:_(t.filename),alt:"Order photo",className:"w-full h-full object-cover cursor-pointer hover:scale-105 transition-transform",onClick:()=>p(t),onError:r=>{console.log("Image failed to load:",t.filename),r.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%23e5e7eb" width="100" height="100"/><text x="50" y="55" text-anchor="middle" fill="%239ca3af" font-size="12">No Image</text></svg>'}}),e.jsx("button",{onClick:r=>{r.stopPropagation(),L(t.id)},className:"absolute top-2 right-2 bg-white/90 text-red-500 p-1.5 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx($,{size:14})})]},t.id))})]}),e.jsxs("div",{className:"bg-[#DCF8C6]/30 rounded-xl p-4 border border-[#DCF8C6]",children:[e.jsxs("p",{className:"text-xs font-bold text-green-800 uppercase tracking-wider mb-1 flex items-center gap-1",children:[e.jsx(M,{size:12})," Remarks"]}),e.jsx("p",{className:"text-sm text-gray-800 whitespace-pre-wrap leading-relaxed",children:s?.remarks||"No remarks provided."})]}),e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-4",children:"Update Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>x("pending"),className:a("relative overflow-hidden p-4 rounded-xl border transition-all duration-300 flex flex-col items-center justify-center gap-2 group",s?.status==="pending"?"bg-gradient-to-br from-amber-400 to-orange-500 border-transparent text-white shadow-lg shadow-orange-500/30 scale-[1.02]":"bg-white border-gray-100 text-gray-500 hover:border-amber-200 hover:bg-amber-50/50 hover:shadow-md"),children:[e.jsx("div",{className:a("p-2 rounded-full transition-colors",s?.status==="pending"?"bg-white/20":"bg-amber-100 text-amber-600"),children:e.jsx(m,{size:20})}),e.jsx("span",{className:"font-bold text-sm",children:"Pending"})]}),e.jsxs("button",{onClick:()=>x("ready"),className:a("relative overflow-hidden p-4 rounded-xl border transition-all duration-300 flex flex-col items-center justify-center gap-2 group",s?.status==="ready"?"bg-gradient-to-br from-blue-400 to-blue-600 border-transparent text-white shadow-lg shadow-blue-500/30 scale-[1.02]":"bg-white border-gray-100 text-gray-500 hover:border-blue-200 hover:bg-blue-50/50 hover:shadow-md"),children:[e.jsx("div",{className:a("p-2 rounded-full transition-colors",s?.status==="ready"?"bg-white/20":"bg-blue-100 text-blue-600"),children:e.jsx(z,{size:20})}),e.jsx("span",{className:"font-bold text-sm",children:"Ready"})]}),e.jsxs("button",{onClick:()=>i(!0),className:a("relative overflow-hidden p-4 rounded-xl border transition-all duration-300 flex flex-col items-center justify-center gap-2 group",s?.status==="delivered"?"bg-gradient-to-br from-[#25D366] to-[#128C7E] border-transparent text-white shadow-lg shadow-green-500/30 scale-[1.02]":"bg-white border-gray-100 text-gray-500 hover:border-green-200 hover:bg-green-50/50 hover:shadow-md"),children:[e.jsx("div",{className:a("p-2 rounded-full transition-colors",s?.status==="delivered"?"bg-white/20":"bg-green-100 text-green-600"),children:e.jsx(P,{size:20})}),e.jsx("span",{className:"font-bold text-sm",children:"Delivered"})]}),e.jsxs("button",{onClick:()=>x("transferred"),className:a("relative overflow-hidden p-4 rounded-xl border transition-all duration-300 flex flex-col items-center justify-center gap-2 group",s?.status==="transferred"?"bg-gradient-to-br from-purple-400 to-purple-600 border-transparent text-white shadow-lg shadow-purple-500/30 scale-[1.02]":"bg-white border-gray-100 text-gray-500 hover:border-purple-200 hover:bg-purple-50/50 hover:shadow-md"),children:[e.jsx("div",{className:a("p-2 rounded-full transition-colors",s?.status==="transferred"?"bg-white/20":"bg-purple-100 text-purple-600"),children:e.jsx(S,{size:20})}),e.jsx("span",{className:"font-bold text-sm",children:"Transferred"})]})]})]}),s?.logs&&s.logs.length>0&&e.jsxs("div",{className:"glass-card rounded-2xl p-5",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 flex items-center gap-2",children:[e.jsx(m,{size:14}),"Status Timeline"]}),e.jsx("div",{className:"space-y-3",children:s.logs.filter(t=>t.action.startsWith("status_changed:")).sort((t,r)=>new Date(r.created_at)-new Date(t.created_at)).map((t,r)=>{const C=t.action.replace("status_changed:",""),d={pending:{color:"amber",icon:m,label:"Pending"},ready:{color:"blue",icon:z,label:"Ready"},delivered:{color:"green",icon:P,label:"Delivered"},transferred:{color:"purple",icon:S,label:"Transferred"}}[C]||{color:"gray",icon:m,label:C},O=d.icon;return e.jsxs("div",{className:"flex items-start gap-3 relative",children:[r<s.logs.filter(A=>A.action.startsWith("status_changed:")).length-1&&e.jsx("div",{className:"absolute left-[15px] top-8 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:`flex-none w-8 h-8 rounded-full bg-${d.color}-100 flex items-center justify-center relative z-10`,children:e.jsx(O,{size:16,className:`text-${d.color}-600`})}),e.jsxs("div",{className:"flex-1 pt-0.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-bold text-sm text-${d.color}-600`,children:d.label}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(t.created_at).toLocaleString("en-IN",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]}),t.note&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.note})]})]},t.id)})})]})]}),I&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60]",style:{bottom:"72px"},onClick:()=>i(!1)}),e.jsxs("div",{className:"fixed left-0 right-0 bg-white rounded-t-2xl shadow-2xl z-[61]",style:{bottom:"72px",maxHeight:"calc(100vh - 140px)"},children:[e.jsxs("div",{className:"bg-[#075E54] p-3 text-white text-center rounded-t-2xl",children:[e.jsx("h3",{className:"text-base font-bold",children:"Collect Payment"}),e.jsx("p",{className:"text-[10px] opacity-80",children:"Enter amount customer is paying now"})]}),e.jsxs("div",{className:"p-3 space-y-2 overflow-y-auto",style:{maxHeight:"calc(100vh - 320px)"},children:[e.jsxs("div",{className:"bg-red-50 p-2 rounded-xl text-center border border-red-100",children:[e.jsx("p",{className:"text-[10px] font-bold text-red-400 uppercase tracking-wider",children:"Due Amount"}),e.jsxs("p",{className:"text-xl font-bold text-red-600",children:["₹",s?.balance||0]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider ml-1",children:"Delivery Date"}),e.jsx(B,{selected:w||D(),onChange:t=>k(t),maxDate:D(),placeholder:"When did customer pick up?",className:"text-sm font-bold text-gray-900"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider ml-1",children:"Payment Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>b("cash"),className:`p-3 rounded-lg border-2 transition-all flex flex-col items-center gap-1 ${u==="cash"?"border-green-500 bg-green-50 text-green-600":"border-gray-200 text-gray-500"}`,children:[e.jsx(G,{size:20}),e.jsx("span",{className:"text-xs font-bold",children:"Cash"})]}),e.jsxs("button",{type:"button",onClick:()=>b("online"),className:`p-3 rounded-lg border-2 transition-all flex flex-col items-center gap-1 ${u==="online"?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-200 text-gray-500"}`,children:[e.jsx(X,{size:20}),e.jsx("span",{className:"text-xs font-bold",children:"Online"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider ml-1",children:"Payment Now"}),e.jsx("input",{type:"number",value:c,onChange:t=>N(t.target.value),className:"w-full text-center text-xl font-bold text-gray-900 border-b-2 border-gray-200 focus:border-green-500 focus:outline-none py-1.5",placeholder:"0"}),e.jsx("div",{className:"flex justify-center text-[10px] font-medium",children:e.jsxs("span",{className:"text-gray-500",children:["Balance: ",e.jsxs("span",{className:a("font-bold",s?.balance-(parseFloat(c)||0)>0?"text-red-500":"text-green-600"),children:["₹",Math.max(0,(s?.balance||0)-(parseFloat(c)||0))]})]})})]})]}),e.jsx("div",{className:"p-3 border-t border-gray-100 bg-white",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>i(!1),className:"py-3 rounded-xl font-bold text-gray-500 bg-gray-100 text-sm",children:"Cancel"}),e.jsx("button",{onClick:()=>x("delivered"),className:"py-3 rounded-xl font-bold bg-[#25D366] text-white text-sm",children:"Confirm"})]})})]})]}),v&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200",onClick:()=>p(null),children:[e.jsx("button",{onClick:()=>p(null),className:"absolute top-4 right-4 text-white/70 hover:text-white bg-white/10 hover:bg-white/20 rounded-full p-2 transition-all",children:e.jsx(U,{size:24})}),e.jsx("img",{src:_(v.filename),alt:"Full view",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl scale-100 transition-transform duration-200",onClick:t=>t.stopPropagation()})]})]})}export{de as default};
